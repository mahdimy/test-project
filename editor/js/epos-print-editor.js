/*! ePOS-Print Editor Version 6.0.3 Copyright (C) Seiko Epson Corporation 2012-2023. All rights reserved. */
var tabindex=0;$(function(){var i=window.localStorage,j,h,g;if(i){j=i.getItem("model");if(j){h=j-0;g=$("#setting-model").get(0);if(!isNaN(h)&&h>=0&&h<g.length){g.selectedIndex=h}}j=i.getItem("width");if(j){$("#setting-width").val(j)}j=i.getItem("ipaddr");if(j){$("#setting-ipaddr").val(j)}j=i.getItem("devid");if(j){$("#setting-devid").val(j)}j=i.getItem("timeout");if(j){h=j-0;if(!isNaN(h)&&h>=0&&h<=300000){$("#setting-timeout").val(h)}}j=i.getItem("status");if(j){if(/^(1|true)$/.test(j)){$("#setting-status").attr("checked","checked")}else{if(/^(0|false)$/.test(j)){$("#setting-status").removeAttr("checked")}}}j=i.getItem("jobid");if(j){if(/^(1|true)$/.test(j)){$("#setting-jobid").attr("checked","checked")}else{if(/^(0|false)$/.test(j)){$("#setting-jobid").removeAttr("checked")}}}j=i.getItem("drawer");if(j){h=j-0;if(!isNaN(h)&&h>=0&&h<=1){$("#setting-drawer").get(0).selectedIndex=h}}j=i.getItem("https");if(j){if(/^(1|true)$/.test(j)){$("#setting-https").attr("checked","checked")}else{if(/^(0|false)$/.test(j)){$("#setting-https").removeAttr("checked")}}}}$("#tabs").tabs({select:function(e,b){switch(tabindex){case 0:try{exportDoc()}catch(a){$("#edit-info").text(a.message);$("#edit-error").dialog("open");return false}break;case 5:try{exportDoc()}catch(a){}setStatusMonitor();break;default:break}switch(b.index){case 1:try{drawPreview()}catch(a){$("#edit-info").text(a.message);$("#edit-error").dialog("open");return false}break;case 2:setApiCode();break;case 3:setXmlDoc();break;case 4:setPrintDoc();break;default:break}tabindex=b.index},selected:tabindex});$("#edit-left").disableSelection().draggable({axis:"y",containment:"parent"});$("#edit-left li").hover(function(){$(this).addClass("ui-state-highlight")},function(){$(this).removeClass("ui-state-highlight")}).click(function(){var a=$(this).clone();$("#edit-sequence").append(a);extract(a)}).draggable({connectToSortable:"#edit-sequence",helper:"clone"});$("#edit-sequence").sortable({placeholder:"edit-holder",update:function(b,a){extract(a.item)}});$("#edit-clear").button().click(function(){$("#edit-confirm").dialog("open")});$("#edit-confirm").dialog({autoOpen:false,width:400,buttons:[{text:message.yes,click:function(){$(this).dialog("close");$("#edit-sequence li").remove();$("#edit-force").removeAttr("checked");$("#edit-left").css({top:0})}},{text:message.no,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#edit-import").button().click(function(){$("#import-doc, #import-info").val("");$("#import").dialog("open")});$("#import").dialog({autoOpen:false,width:600,buttons:[{text:message.close,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#import-apply").button().click(function(){$("#import-confirm").dialog("open")});$("#import-confirm").dialog({autoOpen:false,width:400,buttons:[{text:message.yes,click:function(){$(this).dialog("close");importDoc();$("#edit-left").css({top:0})}},{text:message.no,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#edit-error").dialog({autoOpen:false,width:600,buttons:[{text:message.ok,click:function(){$(this).dialog("close")}}],show:"fade",hide:"fade",draggable:true,resizable:false,modal:true});$("#api-code, #xml-doc").click(function(){$(this).select()}).keydown(function(a){a.preventDefault()}).bind("paste",function(a){a.preventDefault()});$("#print-info, #import-info").change(function(){this.scrollTop=this.scrollHeight}).keydown(function(a){a.preventDefault()}).bind("paste",function(a){a.preventDefault()});$("#print-send").button().click(function(){sendPrintDoc()});$("#print-clear").button().click(function(){$("#print-info").val("")});$("#setting-model").change(function(){if(/^tm_(l90|p60_la)/.test($(this).val())){$(this).next().fadeIn();$("#setting-width").change()}else{$(this).next().fadeOut()}}).change();$("#setting-width").change(function(){var a=$(this).val()-0,e,b;if(/^tm_l90/.test($("#setting-model").val())){if(isNaN(a)||a>80){a=80}else{if(a<38){a=38}}$(this).val(a);b=Math.min(576,256+((a-38)<<3));e=modelinfo.tm_l90_re;e.width=b;e.page.ini_w=b;e.page.max_w=b;b=Math.min(560,224+((a-38)<<3));e=modelinfo.tm_l90_la;e.width=b;e.page.ini_w=b;e.page.max_w=b}else{if(isNaN(a)||a>60){a=60}else{if(a<29){a=29}}$(this).val(a);b=Math.min(400,152+((a-29)<<3));e=modelinfo.tm_p60_la;e.width=b;e.page.ini_w=b;e.page.max_w=b}}).change();epos.address=($("#setting-https").is(":checked")?"https":"http")+"://"+$("#setting-ipaddr").val()+"/cgi-bin/epos/service.cgi?devid="+$("#setting-devid").val()+"&timeout="+$("#setting-timeout").val();$("#setting-timeout").change(function(){var a=$(this).val()-0;if(isNaN(a)||a>300000){a=60000}else{if(a<1000){a=1000}}$(this).val(a)});$(window).bind("unload",function(b){var a=window.localStorage;if(a){a.setItem("model",$("#setting-model").get(0).selectedIndex);a.setItem("width",$("#setting-width").val());a.setItem("ipaddr",$("#setting-ipaddr").val());a.setItem("devid",$("#setting-devid").val());a.setItem("timeout",$("#setting-timeout").val());a.setItem("status",$("#setting-status").is(":checked"));a.setItem("jobid",$("#setting-jobid").is(":checked"));a.setItem("drawer",$("#setting-drawer").get(0).selectedIndex);a.setItem("https",$("#setting-https").is(":checked"))}});$(window).bind("beforeunload",function(a){return message.unload})});function extract(b){b.find("button").button({icons:{primary:"ui-icon-close"},text:false}).click(function(){b.fadeOut("fast",function(){$(this).remove()})});b.find(".attr-text-linespc, .attr-feed-unit, .attr-feed-line, .attr-sound-repeat").each(function(){slider($(this),0,255,1)});b.find(".attr-barcode-height").each(function(){slider($(this),1,255,1)});b.find(".attr-logo-key1, .attr-logo-key2").each(function(){slider($(this),32,126,1)});b.find(".attr-hline-x1, .attr-hline-x2, .attr-vline-x, .attr-area-x").each(function(){slider($(this),0,575,1)});b.find(".attr-area-width").each(function(){slider($(this),1,576,1)});b.find(".attr-text-x, .attr-text-y, .attr-area-y, .attr-position-x, .attr-position-y, .attr-line-x1, .attr-line-y1, .attr-line-x2, .attr-line-y2, .attr-rectangle-x1, .attr-rectangle-y1, .attr-rectangle-x2, .attr-rectangle-y2").each(function(){slider($(this),0,2399,1)});b.find(".attr-area-height").each(function(){slider($(this),1,2400,1)});b.find(".attr-text-width, .attr-text-height").each(function(){slider($(this),1,8,1)});b.find(".attr-image-brightness").each(function(){slider($(this),0.1,10,0.1)});b.find(".attr-barcode-width").each(function(){slider($(this),2,6,1)});b.find(".attr-symbol-width").each(function(){slider($(this),0,16,1)});b.find(".attr-symbol-height").each(function(){slider($(this),0,8,1)});b.find(".attr-symbol-size").each(function(){slider($(this),0,2400,1)});b.find(".attr-symbol-level").each(function(){slider($(this),5,95,1)});b.find(".attr-sound-cycle").each(function(){slider($(this),1000,25500,100)});b.find(".attr-layout-width").each(function(){slider($(this),29,80,0.1)});b.find(".attr-layout-height").each(function(){slider($(this),28.4,310,0.1)});b.find(".attr-layout-margin-top").each(function(){slider($(this),-15,300,0.1)});b.find(".attr-layout-margin-bottom").each(function(){slider($(this),-1.5,1.5,0.1)});b.find(".attr-layout-offset-cut").each(function(){slider($(this),-29,5,0.1)});b.find(".attr-layout-offset-label").each(function(){slider($(this),0,1.5,0.1)});b.find(".tooltip-text").hover(function(){b.find(".tooltip:not(:animated)").fadeIn()},function(){b.find(".tooltip").fadeOut()});b.find(".attr-image-load").click(function(){var a=$(this).nextAll(".attr-image").get(0);a.src=$(this).prevAll(".attr-image-file").val()+"?"+new Date().getTime()});b.find(":text").click(function(){$(this).focus()}).keypress(function(a){if(a.which==13){a.preventDefault()}});b.find(".attr-text-data").css("font","medium "+font);b.find(".attr-layout-height-auto").attr("name",new Date().getTime());b.removeClass("ui-state-highlight");b.find(".edit-caption").css("float","left");b.find("div").show()}function slider(i,g,h,j){i.change(function(){var a=i.val()-0;if(isNaN(a)||a<g){a=g}else{if(a>h){a=h}}i.val(a);$(this).next().slider("value",a)}).next().slider({min:g,max:h,value:i.val()-0,step:j,slide:function(b,a){i.val(a.value)}})}var xml="";var api="";function setApiCode(){var b=new Array();b.push("var canvas = document.getElementById('canvas');");b.push("var context = canvas.getContext('2d');");b.push("var address = '"+($("#setting-https").is(":checked")?"https":"http")+"://"+$("#setting-ipaddr").val()+"/cgi-bin/epos/service.cgi?devid="+$("#setting-devid").val()+"&timeout="+$("#setting-timeout").val()+"';");b.push("");b.push(api);b.push("");b.push("var epos = new epson.ePOSPrint(address);");b.push("epos.onreceive = function (res) { alert(res.success); };");b.push("epos.onerror = function (err) { alert(err.status); };");b.push("epos.oncoveropen = function () { alert('coveropen'); };");b.push("epos.send(builder.toString());");$("#api-code").val(b.join("\n"))}function setXmlDoc(){$("#xml-doc").val(xml)}function exportDoc(){var r=new epson.ePOSBuilder(),t=new Array(),m,e,s=modelinfo[$("#setting-model").val()],u=false,p=true,v=s.page.ini_w,o=s.page.ini_h;t.push("var builder = new epson.ePOSBuilder();");if($("#edit-force").is(":checked")){r.force=true;t.push("builder.force = true;")}try{$("#edit-sequence li").each(function(f){var h,i,g,l,b,j,k,n,w,A,B,a;m=$(this);e=f+1;if(m.hasClass("epos-text-align")){j=m.find(".attr-text-align").val();r.addTextAlign(r[j]);t.push("builder.addTextAlign(builder."+j+");")}else{if(m.hasClass("epos-text-linespc")){j=m.find(".attr-text-linespc").val()|0;r.addTextLineSpace(j);t.push("builder.addTextLineSpace("+j+");")}else{if(m.hasClass("epos-text-rotate")){j=m.find(".attr-text-rotate").is(":checked");r.addTextRotate(j);t.push("builder.addTextRotate("+j+");")}else{if(m.hasClass("epos-text-lang")){j=m.find(".attr-text-lang").val();r.addTextLang(j);t.push("builder.addTextLang('"+j+"');")}else{if(m.hasClass("epos-text-font")){j=m.find(".attr-text-font").val();r.addTextFont(r[j]);t.push("builder.addTextFont(builder."+j+");")}else{if(m.hasClass("epos-text-position")){j=m.find(".attr-text-x").val()|0;r.addTextPosition(j);t.push("builder.addTextPosition("+j+");")}else{if(m.hasClass("epos-text-vposition")){j=m.find(".attr-text-y").val()|0;r.addTextVPosition(j);t.push("builder.addTextVPosition("+j+");")}else{if(m.hasClass("epos-text-smooth")){j=m.find(".attr-text-smooth").is(":checked");r.addTextSmooth(j);t.push("builder.addTextSmooth("+j+");")}else{if(m.hasClass("epos-text-size")){j=m.find(".attr-text-width").val()|0;k=m.find(".attr-text-height").val()|0;r.addTextSize(j,k);t.push("builder.addTextSize("+j+", "+k+");")}else{if(m.hasClass("epos-text-double")){j=m.find(".attr-text-dw").is(":checked");k=m.find(".attr-text-dh").is(":checked");r.addTextDouble(j,k);t.push("builder.addTextDouble("+j+", "+k+");")}else{if(m.hasClass("epos-text-style")){j=m.find(".attr-text-reverse").is(":checked");k=m.find(".attr-text-ul").is(":checked");n=m.find(".attr-text-em").is(":checked");w=m.find(".attr-text-color").val();r.addTextStyle(j,k,n,r[w]);t.push("builder.addTextStyle("+j+", "+k+", "+n+", builder."+w+");")}else{if(m.hasClass("epos-text")){j=m.find(".attr-text-data").val();r.addText(escapeText(j));t.push("builder.addText('"+escapeTextApi(j)+"');")}else{if(m.hasClass("epos-feed-unit")){j=m.find(".attr-feed-unit").val()|0;r.addFeedUnit(j);t.push("builder.addFeedUnit("+j+");")}else{if(m.hasClass("epos-feed-line")){j=m.find(".attr-feed-line").val()|0;r.addFeedLine(j);t.push("builder.addFeedLine("+j+");")}else{if(m.hasClass("epos-feed")){r.addFeed();t.push("builder.addFeed();")}else{if(m.hasClass("epos-feed-pos")){j=m.find(".attr-feed-pos").val();r.addFeedPosition(r[j]);t.push("builder.addFeedPosition(builder."+j+");")}else{if(m.hasClass("epos-image")){j=m.find(".attr-image-color").val();k=m.find(".attr-image-mode").val();n=m.find(".attr-image-brightness").val();w=m.find(".attr-image-halftone").val();A=m.find(".attr-image-fit").is(":checked");g=m.find(".attr-image").get(0);h=$("#epos-image").get(0);if(A){l=u?(p?v:o):s.width;b=g.height*l/g.width|0}else{l=Math.min(g.width,u?(p?v:o):s.width);b=g.height}h.width=l;h.height=b;if(h.getContext){i=h.getContext("2d");i.clearRect(0,0,l,b);if(A){i.drawImage(g,0,0,l,b)}else{i.drawImage(g,0,0,l,b,0,0,l,b)}r.brightness=n;r.halftone=r[w];r.addImage(i,0,0,l,b,r[j],r[k]);t.push("builder.brightness = "+n+";");t.push("builder.halftone = builder."+w+";");t.push("builder.addImage(context, 0, 0, "+l+", "+b+", builder."+j+", builder."+k+");")}}else{if(m.hasClass("epos-logo")){j=m.find(".attr-logo-key1").val()|0;k=m.find(".attr-logo-key2").val()|0;r.addLogo(j,k);t.push("builder.addLogo("+j+", "+k+");")}else{if(m.hasClass("epos-barcode")){j=m.find(".attr-barcode-data").val();k=m.find(".attr-barcode-type").val();n=m.find(".attr-barcode-hri").val();w=m.find(".attr-barcode-font").val();A=m.find(".attr-barcode-width").val()|0;B=m.find(".attr-barcode-height").val()|0;r.addBarcode(escapeTextHex(j),r[k],r[n],r[w],A,B);t.push("builder.addBarcode('"+escapeTextHexApi(j)+"', builder."+k+", builder."+n+", builder."+w+", "+A+", "+B+");")}else{if(m.hasClass("epos-symbol")){j=m.find(".attr-symbol-data").val();k=m.find(".attr-symbol-type").val();n=m.find(".attr-symbol-level-enum").val();w=m.find(".attr-symbol-width").val()|0;A=m.find(".attr-symbol-height").val()|0;B=m.find(".attr-symbol-size").val()|0;a=m.find(".attr-symbol-level").val()|0;if(/^SYMBOL_AZTECCODE/.test(k)){r.addSymbol(escapeTextHex(j),r[k],a,w,A,B);t.push("builder.addSymbol('"+escapeTextHexApi(j)+"', builder."+k+", "+a+", "+w+", "+A+", "+B+");")}else{r.addSymbol(escapeTextHex(j),r[k],r[n],w,A,B);t.push("builder.addSymbol('"+escapeTextHexApi(j)+"', builder."+k+", builder."+n+", "+w+", "+A+", "+B+");")}}else{if(m.hasClass("epos-hline")){j=m.find(".attr-hline-x1").val()|0;k=m.find(".attr-hline-x2").val()|0;n=m.find(".attr-hline-style").val();r.addHLine(j,k,r[n]);t.push("builder.addHLine("+j+", "+k+", builder."+n+");")}else{if(m.hasClass("epos-vline-begin")){j=m.find(".attr-vline-x").val()|0;k=m.find(".attr-vline-style").val();r.addVLineBegin(j,r[k]);t.push("builder.addVLineBegin("+j+", builder."+k+");")}else{if(m.hasClass("epos-vline-end")){j=m.find(".attr-vline-x").val()|0;k=m.find(".attr-vline-style").val();r.addVLineEnd(j,r[k]);t.push("builder.addVLineEnd("+j+", builder."+k+");")}else{if(m.hasClass("epos-page-begin")){r.addPageBegin();t.push("builder.addPageBegin();");u=true;v=s.page.ini_w;o=s.page.ini_h;p=true}else{if(m.hasClass("epos-area")){j=m.find(".attr-area-x").val()|0;k=m.find(".attr-area-y").val()|0;n=m.find(".attr-area-width").val()|0;w=m.find(".attr-area-height").val()|0;r.addPageArea(j,k,n,w);t.push("builder.addPageArea("+j+", "+k+", "+n+", "+w+");");v=n;o=w}else{if(m.hasClass("epos-direction")){j=m.find(".attr-direction-dir").val();r.addPageDirection(r[j]);t.push("builder.addPageDirection(builder."+j+");");p=dir_convert[r[j]].w}else{if(m.hasClass("epos-position")){j=m.find(".attr-position-x").val()|0;k=m.find(".attr-position-y").val()|0;r.addPagePosition(j,k);t.push("builder.addPagePosition("+j+", "+k+");")}else{if(m.hasClass("epos-line")){j=m.find(".attr-line-x1").val()|0;k=m.find(".attr-line-y1").val()|0;n=m.find(".attr-line-x2").val()|0;w=m.find(".attr-line-y2").val()|0;A=m.find(".attr-line-style").val();r.addPageLine(j,k,n,w,r[A]);t.push("builder.addPageLine("+j+", "+k+", "+n+", "+w+", builder."+A+");")}else{if(m.hasClass("epos-rectangle")){j=m.find(".attr-rectangle-x1").val()|0;k=m.find(".attr-rectangle-y1").val()|0;n=m.find(".attr-rectangle-x2").val()|0;w=m.find(".attr-rectangle-y2").val()|0;A=m.find(".attr-rectangle-style").val();r.addPageRectangle(j,k,n,w,r[A]);t.push("builder.addPageRectangle("+j+", "+k+", "+n+", "+w+", builder."+A+");")}else{if(m.hasClass("epos-page-end")){r.addPageEnd();t.push("builder.addPageEnd();");u=false}else{if(m.hasClass("epos-cut")){j=m.find(".attr-cut-type").val();r.addCut(r[j]);t.push("builder.addCut(builder."+j+");")}else{if(m.hasClass("epos-pulse")){j=m.find(".attr-pulse-drawer").val();k=m.find(".attr-pulse-time").val();r.addPulse(r[j],r[k]);t.push("builder.addPulse(builder."+j+", builder."+k+");")}else{if(m.hasClass("epos-sound")){j=m.find(".attr-sound-pattern").val();k=m.find(".attr-sound-repeat").val()|0;n=m.find(".attr-sound-cycle").val()|0;if(/^PATTERN_(10|[0-9])$/.test(j)){r.addSound(r[j],k,n);t.push("builder.addSound(builder."+j+", "+k+", "+n+");")}else{r.addSound(r[j],k);t.push("builder.addSound(builder."+j+", "+k+");")}}else{if(m.hasClass("epos-layout")){j=m.find(".attr-layout-type").val();k=m.find(".attr-layout-width").val()*10|0;n=m.find(".attr-layout-height-auto:first").is(":checked")?0:m.find(".attr-layout-height").val()*10|0;w=m.find(".attr-layout-margin-top").val()*10|0;A=m.find(".attr-layout-margin-bottom").val()*10|0;B=m.find(".attr-layout-offset-cut").val()*10|0;a=m.find(".attr-layout-offset-label").val()*10|0;r.addLayout(r[j],k,n,w,A,B,a);t.push("builder.addLayout(builder."+j+", "+k+", "+n+", "+w+", "+A+", "+B+", "+a+");")}else{if(m.hasClass("epos-recovery")){r.addRecovery();t.push("builder.addRecovery();")}else{if(m.hasClass("epos-reset")){r.addReset();t.push("builder.addReset();")}else{if(m.hasClass("epos-command")){j=m.find(".attr-command-data").val();r.addCommand(escapeTextHex(j));t.push("builder.addCommand('"+escapeTextHexApi(j)+"');")}else{if(m.hasClass("epos-rotate-begin")){r.addRotateBegin();t.push("builder.addRotateBegin();")}else{if(m.hasClass("epos-rotate-end")){r.addRotateEnd();t.push("builder.addRotateEnd();")}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}});xml=r.toString().replace(/><(?!\/(text|barcode|symbol|command)>)/g,">\n<");api=t.join("\n")}catch(q){throw new Error("["+message.line+" "+e+"] "+q)}}function escapeTextHex(f){var e=/\\x[0-9A-Fa-f]{2}/g;if(e.test(f)){f=f.replace(e,function(a){return String.fromCharCode(parseInt(a.slice(2),16))})}return escapeText(f)}function escapeText(f){var e=/\\[tnr\\]|\\/g;if(e.test(f)){f=f.replace(e,function(a){var b="";switch(a){case"\\t":b="\x09";break;case"\\n":b="\x0a";break;case"\\r":b="\x0d";break;case"\\\\":b="\\";break;default:break}return b})}return f}function escapeTextHexApi(f){var e=/\\x[0-9A-Fa-f]{2}|\\[tnr\\]|['"]|\\/g;if(e.test(f)){f=f.replace(e,function(a){var b=a;switch(a){case'"':b='\\"';break;case"'":b="\\'";break;case"\\":b="";break;default:break}return b})}return f}function escapeTextApi(f){var e=/\\[tnr\\]|['"]|\\/g;if(e.test(f)){f=f.replace(e,function(a){var b=a;switch(a){case'"':b='\\"';break;case"'":b="\\'";break;case"\\":b="";break;default:break}return b})}return f}var import_convert={font_font_a:"FONT_A",font_font_b:"FONT_B",font_font_c:"FONT_C",font_font_d:"FONT_D",font_font_e:"FONT_E",font_special_a:"FONT_SPECIAL_A",font_special_b:"FONT_SPECIAL_B",align_left:"ALIGN_LEFT",align_center:"ALIGN_CENTER",align_right:"ALIGN_RIGHT",color_none:"COLOR_NONE",color_color_1:"COLOR_1",color_color_2:"COLOR_2",color_color_3:"COLOR_3",color_color_4:"COLOR_4",feed_peeling:"FEED_PEELING",feed_cutting:"FEED_CUTTING",feed_current_tof:"FEED_CURRENT_TOF",feed_next_tof:"FEED_NEXT_TOF",mode_mono:"MODE_MONO",mode_gray16:"MODE_GRAY16",barcode_upc_a:"BARCODE_UPC_A",barcode_upc_e:"BARCODE_UPC_E",barcode_ean13:"BARCODE_EAN13",barcode_jan13:"BARCODE_JAN13",barcode_ean8:"BARCODE_EAN8",barcode_jan8:"BARCODE_JAN8",barcode_code39:"BARCODE_CODE39",barcode_itf:"BARCODE_ITF",barcode_codabar:"BARCODE_CODABAR",barcode_code93:"BARCODE_CODE93",barcode_code128:"BARCODE_CODE128",barcode_code128_auto:"BARCODE_CODE128_AUTO",barcode_gs1_128:"BARCODE_GS1_128",barcode_gs1_databar_omnidirectional:"BARCODE_GS1_DATABAR_OMNIDIRECTIONAL",barcode_gs1_databar_truncated:"BARCODE_GS1_DATABAR_TRUNCATED",barcode_gs1_databar_limited:"BARCODE_GS1_DATABAR_LIMITED",barcode_gs1_databar_expanded:"BARCODE_GS1_DATABAR_EXPANDED",hri_none:"HRI_NONE",hri_above:"HRI_ABOVE",hri_below:"HRI_BELOW",hri_both:"HRI_BOTH",symbol_pdf417_standard:"SYMBOL_PDF417_STANDARD",symbol_pdf417_truncated:"SYMBOL_PDF417_TRUNCATED",symbol_qrcode_model_1:"SYMBOL_QRCODE_MODEL_1",symbol_qrcode_model_2:"SYMBOL_QRCODE_MODEL_2",symbol_qrcode_micro:"SYMBOL_QRCODE_MICRO",symbol_maxicode_mode_2:"SYMBOL_MAXICODE_MODE_2",symbol_maxicode_mode_3:"SYMBOL_MAXICODE_MODE_3",symbol_maxicode_mode_4:"SYMBOL_MAXICODE_MODE_4",symbol_maxicode_mode_5:"SYMBOL_MAXICODE_MODE_5",symbol_maxicode_mode_6:"SYMBOL_MAXICODE_MODE_6",symbol_gs1_databar_stacked:"SYMBOL_GS1_DATABAR_STACKED",symbol_gs1_databar_stacked_omnidirectional:"SYMBOL_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",symbol_gs1_databar_expanded_stacked:"SYMBOL_GS1_DATABAR_EXPANDED_STACKED",symbol_azteccode_fullrange:"SYMBOL_AZTECCODE_FULLRANGE",symbol_azteccode_compact:"SYMBOL_AZTECCODE_COMPACT",symbol_datamatrix_square:"SYMBOL_DATAMATRIX_SQUARE",symbol_datamatrix_rectangle_8:"SYMBOL_DATAMATRIX_RECTANGLE_8",symbol_datamatrix_rectangle_12:"SYMBOL_DATAMATRIX_RECTANGLE_12",symbol_datamatrix_rectangle_16:"SYMBOL_DATAMATRIX_RECTANGLE_16",level_level_0:"LEVEL_0",level_level_1:"LEVEL_1",level_level_2:"LEVEL_2",level_level_3:"LEVEL_3",level_level_4:"LEVEL_4",level_level_5:"LEVEL_5",level_level_6:"LEVEL_6",level_level_7:"LEVEL_7",level_level_8:"LEVEL_8",level_level_l:"LEVEL_L",level_level_m:"LEVEL_M",level_level_q:"LEVEL_Q",level_level_h:"LEVEL_H",level_default:"LEVEL_DEFAULT",line_thin:"LINE_THIN",line_medium:"LINE_MEDIUM",line_thick:"LINE_THICK",line_thin_double:"LINE_THIN_DOUBLE",line_medium_double:"LINE_MEDIUM_DOUBLE",line_thick_double:"LINE_THICK_DOUBLE",direction_left_to_right:"DIRECTION_LEFT_TO_RIGHT",direction_bottom_to_top:"DIRECTION_BOTTOM_TO_TOP",direction_right_to_left:"DIRECTION_RIGHT_TO_LEFT",direction_top_to_bottom:"DIRECTION_TOP_TO_BOTTOM",cut_no_feed:"CUT_NO_FEED",cut_feed:"CUT_FEED",cut_reserve:"CUT_RESERVE",full_cut_no_feed:"FULL_CUT_NO_FEED",full_cut_feed:"FULL_CUT_FEED",full_cut_reserve:"FULL_CUT_RESERVE",drawer_drawer_1:"DRAWER_1",drawer_drawer_2:"DRAWER_2",pulse_pulse_100:"PULSE_100",pulse_pulse_200:"PULSE_200",pulse_pulse_300:"PULSE_300",pulse_pulse_400:"PULSE_400",pulse_pulse_500:"PULSE_500",pattern_none:"PATTERN_NONE",pattern_pattern_0:"PATTERN_0",pattern_pattern_1:"PATTERN_1",pattern_pattern_2:"PATTERN_2",pattern_pattern_3:"PATTERN_3",pattern_pattern_4:"PATTERN_4",pattern_pattern_5:"PATTERN_5",pattern_pattern_6:"PATTERN_6",pattern_pattern_7:"PATTERN_7",pattern_pattern_8:"PATTERN_8",pattern_pattern_9:"PATTERN_9",pattern_pattern_10:"PATTERN_10",pattern_pattern_a:"PATTERN_A",pattern_pattern_b:"PATTERN_B",pattern_pattern_c:"PATTERN_C",pattern_pattern_d:"PATTERN_D",pattern_pattern_e:"PATTERN_E",pattern_error:"PATTERN_ERROR",pattern_paper_end:"PATTERN_PAPER_END",layout_receipt:"LAYOUT_RECEIPT",layout_receipt_bm:"LAYOUT_RECEIPT_BM",layout_label:"LAYOUT_LABEL",layout_label_bm:"LAYOUT_LABEL_BM",lang_ja:"ja","lang_ja-jp":"ja",lang_ko:"ko","lang_ko-kr":"ko","lang_zh-cn":"zh-cn","lang_zh-hans":"zh-hans","lang_zh-tw":"zh-tw","lang_zh-hant":"zh-hant","lang_ja-ex":"ja-ex",lang_mul:"mul"};function importDoc(){var r=new Array(),v=1,e=1,o=false,p=false,u=false,s="COLOR_1",n,t;try{n=$($.parseXML($("#import-doc").val()));if(n.find("epos-print").size()==0){throw new Error(message.import_noelem)}$("#edit-sequence li").remove();$("#edit-force").removeAttr("checked");if(/^(1|true)$/.test(n.find("epos-print").attr("force"))){$("#edit-force").attr("checked","checked")}n.find("epos-print > page-end").remove();n.find("epos-print > page").after($("<page-end/>"));t=n.find("epos-print > *, epos-print > page > *");t.each(function(a,f){var b=$(this),k=$("#edit-left ul"),i=false,j,m,h,g,l;switch(f.tagName){case"text":if(b.is("[align]")){j=k.find(".epos-text-align").clone();h=b.attr("align");m=import_convert["align_"+h];if(m){j.find(".attr-text-align").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'align="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}if(b.is("[linespc]")){j=k.find(".epos-text-linespc").clone();h=b.attr("linespc");m=h|0;if(isNaN(m)||m<0||m>255){r.push("<"+f.tagName+">"+message.import_inattr+'linespc="'+h+'"');break}j.find(".attr-text-linespc").val(m);$("#edit-sequence").append(j);extract(j)}if(b.is("[rotate]")){j=k.find(".epos-text-rotate").clone();h=b.attr("rotate");if(/^(1|true)$/.test(h)){j.find(".attr-text-rotate").attr("checked","checked")}else{if(/^(0|false)$/.test(h)){j.find(".attr-text-rotate").removeAttr("checked")}else{r.push("<"+f.tagName+">"+message.import_inattr+'rotate="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}if(b.is("[lang]")){j=k.find(".epos-text-lang").clone();m=import_convert[("lang_"+b.attr("lang")).toLowerCase()];j.find(".attr-text-lang").val(m?m:"en");$("#edit-sequence").append(j);extract(j)}if(b.is("[font]")){j=k.find(".epos-text-font").clone();h=b.attr("font");m=import_convert["font_"+h];if(m){j.find(".attr-text-font").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'font="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}if(b.is("[x]")){j=k.find(".epos-text-position").clone();h=b.attr("x");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'x="'+h+'"');break}j.find(".attr-text-x").val(m);$("#edit-sequence").append(j);extract(j)}if(b.is("[y]")){j=k.find(".epos-text-vposition").clone();h=b.attr("y");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y="'+h+'"');break}j.find(".attr-text-y").val(m);$("#edit-sequence").append(j);extract(j)}if(b.is("[smooth]")){j=k.find(".epos-text-smooth").clone();h=b.attr("smooth");if(/^(1|true)$/.test(h)){j.find(".attr-text-smooth").attr("checked","checked")}else{if(/^(0|false)$/.test(h)){j.find(".attr-text-smooth").removeAttr("checked")}else{r.push("<"+f.tagName+">"+message.import_inattr+'smooth="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}if(b.is("[dw], [dh]")){j=k.find(".epos-text-double").clone();h=b.attr("dw");if(h){if(/^(1|true)$/.test(h)){v=2}else{if(/^(0|false)$/.test(h)){v=1}else{r.push("<"+f.tagName+">"+message.import_inattr+'dw="'+h+'"');break}}}h=b.attr("dh");if(h){if(/^(1|true)$/.test(h)){e=2}else{if(/^(0|false)$/.test(h)){e=1}else{r.push("<"+f.tagName+">"+message.import_inattr+'dh="'+h+'"');break}}}if(v==2){j.find(".attr-text-dw").attr("checked","checked")}else{j.find(".attr-text-dw").removeAttr("checked")}if(e==2){j.find(".attr-text-dh").attr("checked","checked")}else{j.find(".attr-text-dh").removeAttr("checked")}$("#edit-sequence").append(j);extract(j);i=v>2||e>2}if(i||b.is("[width], [height]")){j=k.find(".epos-text-size").clone();h=b.attr("width");if(h){m=h|0;if(isNaN(m)||m<1||m>8){r.push("<"+f.tagName+">"+message.import_inattr+'width="'+h+'"');break}v=m}h=b.attr("height");if(h){m=h|0;if(isNaN(m)||m<1||m>8){r.push("<"+f.tagName+">"+message.import_inattr+'height="'+h+'"');break}e=m}j.find(".attr-text-width").val(v);j.find(".attr-text-height").val(e);$("#edit-sequence").append(j);extract(j);i=false}if(b.is("[reverse], [ul], [em], [color]")){j=k.find(".epos-text-style").clone();h=b.attr("reverse");if(h){if(/^(1|true)$/.test(h)){o=true}else{if(/^(0|false)$/.test(h)){o=false}else{r.push("<"+f.tagName+">"+message.import_inattr+'reverse="'+h+'"');break}}}h=b.attr("ul");if(h){if(/^(1|true)$/.test(h)){p=true}else{if(/^(0|false)$/.test(h)){p=false}else{r.push("<"+f.tagName+">"+message.import_inattr+'ul="'+h+'"');break}}}h=b.attr("em");if(h){if(/^(1|true)$/.test(h)){u=true}else{if(/^(0|false)$/.test(h)){u=false}else{r.push("<"+f.tagName+">"+message.import_inattr+'em="'+h+'"');break}}}h=b.attr("color");if(h){m=import_convert["color_"+h];if(m){s=m}else{r.push("<"+f.tagName+">"+message.import_inattr+'color="'+h+'"');break}}if(o){j.find(".attr-text-reverse").attr("checked","checked")}else{j.find(".attr-text-reverse").removeAttr("checked")}if(p){j.find(".attr-text-ul").attr("checked","checked")}else{j.find(".attr-text-ul").removeAttr("checked")}if(u){j.find(".attr-text-em").attr("checked","checked")}else{j.find(".attr-text-em").removeAttr("checked")}j.find(".attr-text-color").val(s);$("#edit-sequence").append(j);extract(j)}if(b.text().length>0){j=k.find(".epos-text").clone();j.find(".attr-text-data").val(escapeCode(b.text()));$("#edit-sequence").append(j);extract(j)}break;case"feed":if(b.is("[linespc]")){j=k.find(".epos-text-linespc").clone();h=b.attr("linespc");m=h|0;if(isNaN(m)||m<0||m>255){r.push("<"+f.tagName+">"+message.import_inattr+'linespc="'+h+'"');break}j.find(".attr-text-linespc").val(m);$("#edit-sequence").append(j);extract(j)}if(b.is("[unit]")){j=k.find(".epos-feed-unit").clone();h=b.attr("unit");m=h|0;if(isNaN(m)||m<0||m>255){r.push("<"+f.tagName+">"+message.import_inattr+'unit="'+h+'"');break}j.find(".attr-feed-unit").val(m);$("#edit-sequence").append(j);extract(j)}if(b.is("[line]")){j=k.find(".epos-feed-line").clone();h=b.attr("line");m=h|0;if(isNaN(m)||m<0||m>255){r.push("<"+f.tagName+">"+message.import_inattr+'line="'+h+'"');break}j.find(".attr-feed-line").val(m);$("#edit-sequence").append(j);extract(j)}if(b.is(":not([unit], [line], [pos])")){j=k.find(".epos-feed").clone();$("#edit-sequence").append(j);extract(j)}if(b.is("[pos]")){j=k.find(".epos-feed-pos").clone();h=b.attr("pos");m=import_convert["feed_"+h];if(m){j.find(".attr-feed-pos").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'pos="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}break;case"image":if(b.is("[align]")){j=k.find(".epos-text-align").clone();h=b.attr("align");m=import_convert["align_"+h];if(m){j.find(".attr-text-align").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'align="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}if(b.is("[width][height]")){j=k.find(".epos-image").clone();h=b.attr("mode");if(h){m=import_convert["mode_"+h];if(m){j.find(".attr-image-mode").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'mode="'+h+'"');break}}h=b.attr("color");if(h){m=import_convert["color_"+h];if(m){j.find(".attr-image-color").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'color="'+h+'"');break}}g=$("#epos-image").get(0);h=b.attr("width");m=h|0;if(isNaN(m)||m<1){r.push("<"+f.tagName+">"+message.import_inattr+'width="'+h+'"');break}g.width=m;h=b.attr("height");m=h|0;if(isNaN(m)||m<1){r.push("<"+f.tagName+">"+message.import_inattr+'height="'+h+'"');break}g.height=m;l=decodeBase64(b.text());if(b.attr("mode")=="gray16"){if(l.length==((g.width+1)>>1)*g.height){drawGray16(g,l)}else{r.push("<"+f.tagName+">"+message.import_intext);break}}else{if(l.length==((g.width+7)>>3)*g.height){drawMono(g,l)}else{r.push("<"+f.tagName+">"+message.import_intext);break}}j.find(".attr-image").attr({src:g.toDataURL()});j.find(".attr-image-file").val("");$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"width", "height"')}break;case"logo":if(b.is("[align]")){j=k.find(".epos-text-align").clone();h=b.attr("align");m=import_convert["align_"+h];if(m){j.find(".attr-text-align").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'align="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}if(b.is("[key1][key2]")){j=k.find(".epos-logo").clone();h=b.attr("key1");m=h|0;if(isNaN(m)||m<32||m>126){r.push("<"+f.tagName+">"+message.import_inattr+'key1="'+h+'"');break}j.find(".attr-logo-key1").val(m);h=b.attr("key2");m=h|0;if(isNaN(m)||m<32||m>126){r.push("<"+f.tagName+">"+message.import_inattr+'key2="'+h+'"');break}j.find(".attr-logo-key2").val(m);$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"key1", "key2"')}break;case"barcode":if(b.is("[align]")){j=k.find(".epos-text-align").clone();h=b.attr("align");m=import_convert["align_"+h];if(m){j.find(".attr-text-align").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'align="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}if(b.is("[rotate]")){j=k.find(".epos-text-rotate").clone();h=b.attr("rotate");if(/^(1|true)$/.test(h)){j.find(".attr-text-rotate").attr("checked","checked")}else{if(/^(0|false)$/.test(h)){j.find(".attr-text-rotate").removeAttr("checked")}else{r.push("<"+f.tagName+">"+message.import_inattr+'rotate="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}if(b.is("[type]")){j=k.find(".epos-barcode").clone();h=b.attr("type");m=import_convert["barcode_"+h];if(m){j.find(".attr-barcode-type").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'type="'+h+'"');break}h=b.attr("hri");if(h){m=import_convert["hri_"+h];if(m){j.find(".attr-barcode-hri").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'hri="'+h+'"');break}}h=b.attr("font");if(h){m=import_convert["font_"+h];if(m){j.find(".attr-barcode-font").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'font="'+h+'"');break}}h=b.attr("width");if(h){m=h|0;if(isNaN(m)||m<2||m>6){r.push("<"+f.tagName+">"+message.import_inattr+'width="'+h+'"');break}j.find(".attr-barcode-width").val(m)}h=b.attr("height");if(h){m=h|0;if(isNaN(m)||m<1||m>255){r.push("<"+f.tagName+">"+message.import_inattr+'height="'+h+'"');break}j.find(".attr-barcode-height").val(m)}j.find(".attr-barcode-data").val(escapeCode(b.text()));$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"type"')}break;case"symbol":if(b.is("[align]")){j=k.find(".epos-text-align").clone();h=b.attr("align");m=import_convert["align_"+h];if(m){j.find(".attr-text-align").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'align="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}if(b.is("[rotate]")){j=k.find(".epos-text-rotate").clone();h=b.attr("rotate");if(/^(1|true)$/.test(h)){j.find(".attr-text-rotate").attr("checked","checked")}else{if(/^(0|false)$/.test(h)){j.find(".attr-text-rotate").removeAttr("checked")}else{r.push("<"+f.tagName+">"+message.import_inattr+'rotate="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}if(b.is("[type]")){j=k.find(".epos-symbol").clone();h=b.attr("type");m=import_convert["symbol_"+h];if(m){j.find(".attr-symbol-type").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'type="'+h+'"');break}h=b.attr("level");if(h){m=import_convert["level_"+h];if(m){j.find(".attr-symbol-level-enum").val(m)}else{m=h|0;if(isNaN(m)||m<5||m>95){r.push("<"+f.tagName+">"+message.import_inattr+'level="'+h+'"');break}j.find(".attr-symbol-level").val(m)}}h=b.attr("width");if(h){m=h|0;if(isNaN(m)||m<0||m>16){r.push("<"+f.tagName+">"+message.import_inattr+'width="'+h+'"');break}j.find(".attr-symbol-width").val(m)}h=b.attr("height");if(h){m=h|0;if(isNaN(m)||m<0||m>8){r.push("<"+f.tagName+">"+message.import_inattr+'height="'+h+'"');break}j.find(".attr-symbol-height").val(m)}h=b.attr("size");if(h){m=h|0;if(isNaN(m)||m<0||m>2400){r.push("<"+f.tagName+">"+message.import_inattr+'size="'+h+'"');break}j.find(".attr-symbol-size").val(m)}j.find(".attr-symbol-data").val(escapeCode(b.text()));$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"type"')}break;case"hline":if(b.is("[x1][x2]")){j=k.find(".epos-hline").clone();h=b.attr("x1");m=h|0;if(isNaN(m)||m<0||m>575){r.push("<"+f.tagName+">"+message.import_inattr+'x1="'+h+'"');break}j.find(".attr-hline-x1").val(m);h=b.attr("x2");m=h|0;if(isNaN(m)||m<0||m>575){r.push("<"+f.tagName+">"+message.import_inattr+'x2="'+h+'"');break}j.find(".attr-hline-x2").val(m);h=b.attr("style");if(h){m=import_convert["line_"+h];if(m){j.find(".attr-hline-style").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'style="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x1", "x2"')}break;case"vline-begin":if(b.is("[x]")){j=k.find(".epos-vline-begin").clone();h=b.attr("x");m=h|0;if(isNaN(m)||m<0||m>575){r.push("<"+f.tagName+">"+message.import_inattr+'x="'+h+'"');break}j.find(".attr-vline-x").val(m);h=b.attr("style");if(h){m=import_convert["line_"+h];if(m){j.find(".attr-vline-style").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'style="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x"')}break;case"vline-end":if(b.is("[x]")){j=k.find(".epos-vline-end").clone();h=b.attr("x");m=h|0;if(isNaN(m)||m<0||m>575){r.push("<"+f.tagName+">"+message.import_inattr+'x="'+h+'"');break}j.find(".attr-vline-x").val(m);h=b.attr("style");if(h){m=import_convert["line_"+h];if(m){j.find(".attr-vline-style").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'style="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x"')}break;case"page":j=k.find(".epos-page-begin").clone();$("#edit-sequence").append(j);extract(j);break;case"area":if(b.is("[x][y][width][height]")){j=k.find(".epos-area").clone();h=b.attr("x");m=h|0;if(isNaN(m)||m<0||m>575){r.push("<"+f.tagName+">"+message.import_inattr+'x="'+h+'"');break}j.find(".attr-area-x").val(m);h=b.attr("y");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y="'+h+'"');break}j.find(".attr-area-y").val(m);h=b.attr("width");m=h|0;if(isNaN(m)||m<1||m>576){r.push("<"+f.tagName+">"+message.import_inattr+'width="'+h+'"');break}j.find(".attr-area-width").val(m);h=b.attr("height");m=h|0;if(isNaN(m)||m<1||m>2400){r.push("<"+f.tagName+">"+message.import_inattr+'height="'+h+'"');break}j.find(".attr-area-height").val(m);$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x", "y", "width", "height"')}break;case"direction":if(b.is("[dir]")){j=k.find(".epos-direction").clone();h=b.attr("dir");m=import_convert["direction_"+h];if(m){j.find(".attr-direction-dir").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'dir="'+h+'"');break}$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"dir"')}break;case"position":if(b.is("[x][y]")){j=k.find(".epos-position").clone();h=b.attr("x");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'x="'+h+'"');break}j.find(".attr-position-x").val(m);h=b.attr("y");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y="'+h+'"');break}j.find(".attr-position-y").val(m);$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x", "y"')}break;case"line":if(b.is("[x1][y1][x2][y2]")){j=k.find(".epos-line").clone();h=b.attr("x1");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'x1="'+h+'"');break}j.find(".attr-line-x1").val(m);h=b.attr("y1");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y1="'+h+'"');break}j.find(".attr-line-y1").val(m);h=b.attr("x2");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'x2="'+h+'"');break}j.find(".attr-line-x2").val(m);h=b.attr("y2");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y2="'+h+'"');break}j.find(".attr-line-y2").val(m);h=b.attr("style");if(h){m=import_convert["line_"+h];if(m){j.find(".attr-line-style").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'style="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x1", "y1", "x2", "y2"')}break;case"rectangle":if(b.is("[x1][y1][x2][y2]")){j=k.find(".epos-rectangle").clone();h=b.attr("x1");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'x1="'+h+'"');break}j.find(".attr-rectangle-x1").val(m);h=b.attr("y1");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y1="'+h+'"');break}j.find(".attr-rectangle-y1").val(m);h=b.attr("x2");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'x2="'+h+'"');break}j.find(".attr-rectangle-x2").val(m);h=b.attr("y2");m=h|0;if(isNaN(m)||m<0||m>2399){r.push("<"+f.tagName+">"+message.import_inattr+'y2="'+h+'"');break}j.find(".attr-rectangle-y2").val(m);h=b.attr("style");if(h){m=import_convert["line_"+h];if(m){j.find(".attr-rectangle-style").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'style="'+h+'"');break}}$("#edit-sequence").append(j);extract(j)}else{r.push("<"+f.tagName+">"+message.import_noattr+'"x1", "y1", "x2", "y2"')}break;case"page-end":j=k.find(".epos-page-end").clone();$("#edit-sequence").append(j);extract(j);break;case"cut":j=k.find(".epos-cut").clone();h=b.attr("type");if(h){m=import_convert["cut_"+h];if(m){j.find(".attr-cut-type").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'type="'+h+'"');break}}$("#edit-sequence").append(j);extract(j);break;case"pulse":j=k.find(".epos-pulse").clone();h=b.attr("drawer");if(h){m=import_convert["drawer_"+h];if(m){j.find(".attr-pulse-drawer").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'drawer="'+h+'"');break}}h=b.attr("time");if(h){m=import_convert["pulse_"+h];if(m){j.find(".attr-pulse-time").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'time="'+h+'"');break}}$("#edit-sequence").append(j);extract(j);break;case"sound":j=k.find(".epos-sound").clone();h=b.attr("pattern");if(h){m=import_convert["pattern_"+h];if(m){j.find(".attr-sound-pattern").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'pattern="'+h+'"');break}}h=b.attr("repeat");if(h){m=h|0;if(isNaN(m)||m<0||m>255){r.push("<"+f.tagName+">"+message.import_inattr+'repeat="'+h+'"');break}j.find(".attr-sound-repeat").val(m)}h=b.attr("cycle");if(h){m=h|0;if(isNaN(m)||m<1000||m>25500){r.push("<"+f.tagName+">"+message.import_inattr+'cycle="'+h+'"');break}j.find(".attr-sound-cycle").val(m)}$("#edit-sequence").append(j);extract(j);break;case"layout":j=k.find(".epos-layout").clone();h=b.attr("type");m=import_convert["layout_"+h];if(m){j.find(".attr-layout-type").val(m)}else{r.push("<"+f.tagName+">"+message.import_inattr+'type="'+h+'"');break}h=b.attr("width");if(h){m=(h|0)/10;if(isNaN(m)||m<29||m>80){r.push("<"+f.tagName+">"+message.import_inattr+'width="'+h+'"');break}j.find(".attr-layout-width").val(m)}h=b.attr("height");if(h){m=(h|0)/10;if(isNaN(m)||(m!=0&&m<28.4)||m>310){r.push("<"+f.tagName+">"+message.import_inattr+'height="'+h+'"');break}if(m!==0){j.find(".attr-layout-height-auto:first").removeAttr("checked");j.find(".attr-layout-height-auto:last").attr("checked","checked");j.find(".attr-layout-height").val(m)}}h=b.attr("margin-top");if(h){m=(h|0)/10;if(isNaN(m)||m<-15||m>300){r.push("<"+f.tagName+">"+message.import_inattr+'margin-top="'+h+'"');break}j.find(".attr-layout-margin-top").val(m)}h=b.attr("margin-bottom");if(h){m=(h|0)/10;if(isNaN(m)||m<-1.5||m>1.5){r.push("<"+f.tagName+">"+message.import_inattr+'margin-bottom="'+h+'"');break}j.find(".attr-layout-margin-bottom").val(m)}h=b.attr("offset-cut");if(h){m=(h|0)/10;if(isNaN(m)||m<-29||m>5){r.push("<"+f.tagName+">"+message.import_inattr+'offset-cut="'+h+'"');break}j.find(".attr-layout-offset-cut").val(m)}h=b.attr("offset-label");if(h){m=(h|0)/10;if(isNaN(m)||m<0||m>1.5){r.push("<"+f.tagName+">"+message.import_inattr+'offset-label="'+h+'"');break}j.find(".attr-layout-offset-label").val(m)}$("#edit-sequence").append(j);extract(j);break;case"recovery":j=k.find(".epos-recovery").clone();$("#edit-sequence").append(j);extract(j);break;case"reset":j=k.find(".epos-reset").clone();$("#edit-sequence").append(j);extract(j);break;case"command":j=k.find(".epos-command").clone();j.find(".attr-command-data").val(decodeHex(b.text()));$("#edit-sequence").append(j);extract(j);break;case"rotate-begin":j=k.find(".epos-rotate-begin").clone();$("#edit-sequence").append(j);extract(j);break;case"rotate-end":j=k.find(".epos-rotate-end").clone();$("#edit-sequence").append(j);extract(j);break;default:r.push("<"+f.tagName+">"+message.import_inelem);break}});if(r.length>0){r.push("")}r.push(message.import_complete)}catch(q){r.push(q.message);r.push("");r.push(message.import_abort)}r.push("");$("#import-info").val(r.join("\n")).change()}function escapeCode(f){var e=/[\t\n\r\\]/g;if(e.test(f)){f=f.replace(e,function(a){var b="";switch(a){case"\t":b="\\t";break;case"\n":b="\\n";break;case"\r":b="\\r";break;case"\\":b="\\\\";break;default:break}return b})}return f}function decodeHex(f){var e=/[0-9A-Fa-f]{2}/g;f=f.replace(/[^0-9A-Fa-f]/g,"");f=f.slice(0,f.length&~1);if(e.test(f)){f=f.replace(e,function(a){return"\\x"+a})}return f}function decodeBase64(i){var n=String.fromCharCode,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l={},r,t,s,p,q;for(q=0;q<64;q++){l[j.charAt(q)]=q}i=i.replace(/[^A-Za-z0-9\+\/]/g,"");r=i.length;t=new Array((r+3>>2)*3);i+="AAA";q=0;p=0;while(p<r){s=l[i.charAt(p++)]<<18|l[i.charAt(p++)]<<12|l[i.charAt(p++)]<<6|l[i.charAt(p++)];t[q++]=n(s>>16&255);t[q++]=n(s>>8&255);t[q++]=n(s&255)}t.length-=(4-r%4)%4;return t.join("")}function drawMono(s,l){var t,i,o,r,j,p=0,q=0;if(s.getContext){t=s.getContext("2d");i=t.getImageData(0,0,(s.width+7)&~7,s.height);o=i.data;r=o.length>>2;while(p<r){j=(l.charCodeAt(p>>3)&(128>>(p&7)))==0?255:0;o[q++]=j;o[q++]=j;o[q++]=j;o[q++]=255;p++}t.putImageData(i,0,0)}}function drawGray16(u,l){var q=[0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,6,7,7,7,7,8,8,8,8,8,9,9,9,9,10,10,10,10,10,11,12,12,13,13,14,15,15,16,16,17,17,18,19,19,20,20,21,22,24,25,26,27,28,29,30,31,32,33,34,35,37,38,39,40,42,44,45,47,48,50,52,53,55,56,58,60,61,63,64,66,68,70,72,74,77,79,81,83,85,87,89,91,93,95,97,99,102,104,106,109,111,114,116,118,121,123,126,128,130,133,135,138,140,142,145,147,150,152,155,157,160,162,165,167,170,172,175,177,180,182,185,187,189,191,193,195,198,200,202,204,206,209,211,213,215,217,220,222,223,225,226,228,229,231,232,234,235,237,238,240,241,243,244,246,247,248,248,248,249,249,250,250,251,251,252,252,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],v,i,p,t,j,r=0,s=0;if(u.getContext){v=u.getContext("2d");i=v.getImageData(0,0,(u.width+1)&~1,u.height);p=i.data;t=p.length>>1;while(r<t){j=q[(l.charCodeAt(r>>1)&240)+8];p[s++]=j;p[s++]=j;p[s++]=j;p[s++]=255;r++;j=q[((l.charCodeAt(r>>1)&15)<<4)+8];p[s++]=j;p[s++]=j;p[s++]=j;p[s++]=255;r++}v.putImageData(i,0,0)}}var color_convert={none:"#ffffff",color_1:"#000000",color_2:"#c00000",color_3:"#00c000",color_4:"#0000c0"};var line_convert={thin:{w:1,d:false},medium:{w:2,d:false},thick:{w:4,d:false},thin_double:{w:1,d:true},medium_double:{w:2,d:true},thick_double:{w:4,d:true}};var dir_convert={left_to_right:{x:0,y:0,r:0,w:true},top_to_bottom:{x:1,y:0,r:Math.PI*0.5000001,w:false},right_to_left:{x:1,y:1,r:Math.PI,w:true},bottom_to_top:{x:0,y:1,r:Math.PI*1.5000001,w:false}};var model=modelinfo.tm_t88_80;var align="left";var linespc=30;var rotate=false;var line_x=0;var line_y=191;var line_w=0;var line_h=0;var text_l="en";var text_f="font_a";var text_s=false;var text_w=1;var text_h=1;var text_r=false;var text_u=false;var text_e=false;var text_c=color_convert.color_1;var font_a=24;var font_k=24;var hline=[];var vline=[];var page=false;var page_linespc=30;var page_h=0;var area_x=0;var area_y=0;var area_w=512;var area_h=831;var area_valid=false;var page_dir=dir_convert.left_to_right;var page_x=0;var page_y=23;var matome=false;var current_canvas_line=0;var no_rotate_part=new Array();function drawPreview(){var g=new epson.ePOSBuilder(),f,i;model=modelinfo[$("#setting-model").val()];align="left";linespc=model.linespc;rotate=false;line_x=0;line_y=191;line_w=0;line_h=0;text_l="en";text_f="font_a";text_s=false;text_w=1;text_h=1;text_r=false;text_u=false;text_e=false;text_c=color_convert.color_1;font_a=24;font_k=24;hline=[];vline=[];page=false;matome=false;page_linespc=model.linespc;current_canvas_line=0;var h=-1;no_rotate_part=[];f=$("#preview-text").get(0);if(f.getContext){i=f.getContext("2d");i.clearRect(0,0,f.width,f.height)}$("#preview-rotate").height(0);$("#preview-paper canvas").remove();$("#preview-paper").width(model.width);$("#preview-width span").text(model.width);$("#preview-width img:eq(1)").attr("width",model.width-2);$("#edit-sequence li").each(function(){var a=$(this),s,t,r,b,e,o,p,q;if(a.hasClass("epos-text-align")){b=g[a.find(".attr-text-align").val()];if(page){align=b}else{if(line_w==0&&line_x==0){align=b}}}else{if(a.hasClass("epos-text-linespc")){b=a.find(".attr-text-linespc").val()-0;if(page){page_linespc=b}else{linespc=b}}else{if(a.hasClass("epos-text-rotate")){b=a.find(".attr-text-rotate").is(":checked");if(page){rotate=b}else{if(line_w==0&&line_x==0){rotate=b}}}else{if(a.hasClass("epos-text-lang")){text_l=a.find(".attr-text-lang").val()}else{if(a.hasClass("epos-text-font")){text_f=g[a.find(".attr-text-font").val()]}else{if(a.hasClass("epos-text-position")){b=a.find(".attr-text-x").val()-0;if(page){if(b<(page_dir.w?area_w:area_h)){page_x=b}}else{if(b<model.width){line_x=b}}}else{if(a.hasClass("epos-text-vposition")){b=a.find(".attr-text-y").val()-0;if(page){if(b<(page_dir.w?area_h:area_w)){page_y=b}}else{}}else{if(a.hasClass("epos-text-smooth")){text_s=a.find(".attr-text-smooth").is(":checked")}else{if(a.hasClass("epos-text-size")){text_w=a.find(".attr-text-width").val()-0;text_h=a.find(".attr-text-height").val()-0}else{if(a.hasClass("epos-text-double")){text_w=a.find(".attr-text-dw").is(":checked")?2:1;text_h=a.find(".attr-text-dh").is(":checked")?2:1}else{if(a.hasClass("epos-text-style")){text_r=a.find(".attr-text-reverse").is(":checked");text_u=a.find(".attr-text-ul").is(":checked");text_e=a.find(".attr-text-em").is(":checked");text_c=color_convert[g[a.find(".attr-text-color").val()]]}else{if(a.hasClass("epos-text")){b=escapeText(a.find(".attr-text-data").val());if(page){drawPageText(b)}else{drawText(b)}}else{if(a.hasClass("epos-feed-unit")){b=a.find(".attr-feed-unit").val()-0;if(page){drawPageFeed(b)}else{drawFeed(b)}}else{if(a.hasClass("epos-feed-line")){b=a.find(".attr-feed-line").val()-0;if(page){drawPageFeed(b*page_linespc)}else{drawFeed(b*linespc)}}else{if(a.hasClass("epos-feed")){if(page){drawPageFeed(page_linespc)}else{drawFeed(linespc)}}else{if(a.hasClass("epos-feed-pos")){b=g[a.find(".attr-feed-pos").val()];if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(a.find("img").get(0),b)}}else{if(a.hasClass("epos-image")){b=g[a.find(".attr-image-color").val()];e=g[a.find(".attr-image-mode").val()];o=a.find(".attr-image-brightness").val()-0;p=g[a.find(".attr-image-halftone").val()];q=a.find(".attr-image-fit").is(":checked");r=a.find(".attr-image").get(0);if(page){drawPageImage(r,b,e,o,p,q)}else{if(line_w==0){drawImage(r,b,e,o,p,q)}}}else{if(a.hasClass("epos-logo")){b=a.find(".attr-logo-key1").val()-0;e=a.find(".attr-logo-key2").val()-0;if(page){drawPageIcon(a.find("img").get(0),b+", "+e,false)}else{if(line_w==0){drawIcon(a.find("img").get(0),b+", "+e)}}}else{if(a.hasClass("epos-barcode")){b=a.find(".attr-barcode-data").val();e=g[a.find(".attr-barcode-type").val()];if(page){drawPageIcon(a.find("img").get(0),e+", "+b,false)}else{if(line_w==0){drawIcon(a.find("img").get(0),e+", "+b)}}}else{if(a.hasClass("epos-symbol")){b=a.find(".attr-symbol-data").val();e=g[a.find(".attr-symbol-type").val()];if(page){drawPageIcon(a.find("img").get(0),e+", "+b,true)}else{if(line_w==0){drawIcon(a.find("img").get(0),e+", "+b)}}}else{if(a.hasClass("epos-hline")){b=a.find(".attr-hline-x1").val()-0;e=a.find(".attr-hline-x2").val()-0;o=g[a.find(".attr-hline-style").val()];if(page){}else{hline.push({x1:Math.min(b,e),x2:Math.max(b,e),style:o})}}else{if(a.hasClass("epos-vline-begin")){b=a.find(".attr-vline-x").val()-0;e=g[a.find(".attr-vline-style").val()];if(page){}else{vline[e+b]={x:b,style:e}}}else{if(a.hasClass("epos-vline-end")){b=a.find(".attr-vline-x").val()-0;e=g[a.find(".attr-vline-style").val()];if(page){}else{delete vline[e+b]}}else{if(a.hasClass("epos-page-begin")){if(page){}else{if(line_w==0&&line_x==0){s=$("#preview-page").get(0);if(s.getContext){t=s.getContext("2d");t.clearRect(0,0,s.width,s.height)}s=$("#preview-area").get(0);if(s.getContext){t=s.getContext("2d");t.clearRect(0,0,s.width,s.height)}page=true;page_h=0;area_x=0;area_y=0;area_w=model.page.ini_w;area_h=model.page.ini_h;area_valid=false;page_dir=dir_convert.left_to_right;page_x=0;page_y=23;vline=[];if(h>=0){RotatePage(h);h=-2}}}}else{if(a.hasClass("epos-area")){b=a.find(".attr-area-x").val()-0;e=a.find(".attr-area-y").val()-0;o=a.find(".attr-area-width").val()-0;p=a.find(".attr-area-height").val()-0;if(page){moveAreaToPage();area_x=b;area_y=e;area_w=o;area_h=p;area_valid=true;page_x=0;page_y=23}else{}}else{if(a.hasClass("epos-direction")){b=g[a.find(".attr-direction-dir").val()];if(page){page_dir=dir_convert[b];page_x=0;page_y=23}else{}}else{if(a.hasClass("epos-position")){b=a.find(".attr-position-x").val()-0;e=a.find(".attr-position-y").val()-0;if(page){if(b<(page_dir.w?area_w:area_h)){page_x=b}if(e<(page_dir.w?area_h:area_w)){page_y=e}}else{}}else{if(a.hasClass("epos-line")){b=a.find(".attr-line-x1").val()-0;e=a.find(".attr-line-y1").val()-0;o=a.find(".attr-line-x2").val()-0;p=a.find(".attr-line-y2").val()-0;q=g[a.find(".attr-line-style").val()];if(page){drawPageLine(Math.min(b,o),Math.min(e,p),Math.max(b,o),Math.max(e,p),line_convert[q])}else{}}else{if(a.hasClass("epos-rectangle")){b=a.find(".attr-rectangle-x1").val()-0;e=a.find(".attr-rectangle-y1").val()-0;o=a.find(".attr-rectangle-x2").val()-0;p=a.find(".attr-rectangle-y2").val()-0;q=g[a.find(".attr-rectangle-style").val()];if(page){drawPageRect(Math.min(b,o),Math.min(e,p),Math.max(b,o),Math.max(e,p),line_convert[q])}else{}}else{if(a.hasClass("epos-page-end")){if(page){moveAreaToPage();drawPage();page=false;if(h==-2){h=current_canvas_line}}else{}}else{if(a.hasClass("epos-cut")){b=g[a.find(".attr-cut-type").val()];if(page){}else{if(line_w==0&&line_x==0){drawFixedIcon(a.find("img").get(0),b)}}}else{if(a.hasClass("epos-pulse")){b=g[a.find(".attr-pulse-drawer").val()];e=g[a.find(".attr-pulse-time").val()];if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(a.find("img").get(0),b+", "+e)}}else{if(a.hasClass("epos-sound")){b=g[a.find(".attr-sound-pattern").val()];e=a.find(".attr-sound-repeat").val()-0;if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(a.find("img").get(0),b+", "+e)}}else{if(a.hasClass("epos-layout")){b=g[a.find(".attr-layout-type").val()];if(page){}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(a.find("img").get(0),b)}}else{if(a.hasClass("epos-recovery")){if(page){}else{drawFixedIcon(a.find("img").get(0),"")}}else{if(a.hasClass("epos-reset")){if(page){}else{drawFixedIcon(a.find("img").get(0),"")}}else{if(a.hasClass("epos-command")){b=a.find(".attr-command-data").val();if(page){drawPageIcon(a.find("img").get(0),b)}else{if(line_w>0){drawFeed(linespc)}drawFixedIcon(a.find("img").get(0),b,false)}}else{if(a.hasClass("epos-rotate-begin")){if(h==-1){h=current_canvas_line}}else{if(a.hasClass("epos-rotate-end")){if(h>=0){RotatePage(h);h=-1}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}});if(hline.length>0){drawHLine()}}function drawText(k){var j,m,l,n,i;if(hline.length>0){drawHLine()}j=$("#preview-text").get(0);if(j.getContext){m=j.getContext("2d");m.textAlign="left";m.textBaseline="alphabetic";var o=k.match(/[\ud800-\udbff][\udc00-\udfff]|[\u304B\u304D\u304F\u3051\u3053\u30AB\u30AD\u30AF\u30B1\u30B3\u30BB\u30C4\u30C8\u31F7]\u309A|[\u00E6\u0254\u028C\u0259\u025A]\u0300|[\u0254\u028C\u0259\u025A]\u0301|\u02E9\u02E5|\u02E5\u02E9|[^\ud800-\udfff]/g)||[];for(n=0;n<o.length;n++){l=o[n];switch(l){case"\t":if(line_x==model.width){drawFeed(linespc)}i=font_a*4;line_x=Math.floor(line_x/i)*i+i;if(line_x>model.width){drawFeed(linespc)}break;case"\n":drawFeed(linespc);break;case"\r":break;default:drawChar(m,l);break}}}}function drawChar(n,l){var j,k,h,m;n.font="24px "+font;if(n.measureText(l).width<18){m=model.ank[text_f];if(m==0){m=font_a}else{font_a=m}h=m/2}else{m=model.kanji[text_f];if(m==0){m=font_k}else{font_k=m}h=m}n.font=(m-2)+"px "+font;if(line_x+h*text_w>model.width){drawFeed(linespc)}line_h=Math.max(line_h,m*text_h);j=line_x/text_w;k=line_y/text_h;n.fillStyle=text_c;n.strokeStyle=text_c;n.shadowColor=text_c;n.setTransform(text_w,0,0,text_h,0,0);if(rotate){n.translate(576/text_w,192/text_h);n.rotate(Math.PI)}if(text_r){n.fillRect(j,k,h,-m);c="#f0f0f0";n.fillStyle=c;n.strokeStyle=c;n.shadowColor=c}if(h==m&&text_l=="en"){n.strokeRect(j+2,k-2,h-4,4-m)}else{n.shadowBlur=text_s?2:0;n.fillText(l,j,k-4);if(text_e){n.fillText(l,j+1,k-4)}n.shadowBlur=0}if(text_u){n.fillRect(j,k-1,h,1)}n.setTransform(1,0,0,1,0,0);line_x+=h*text_w;line_w=Math.max(line_w,line_x)}function drawFeed(l){var q,r,i,s,n=0,o,p,t;if(hline.length>0){drawHLine()}q=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:Math.max(line_h,l)}).get(0);i=$("#preview-text").get(0);if(q.getContext&&i.getContext){r=q.getContext("2d");s=i.getContext("2d");if(line_w>0){if(rotate){if(align!="right"){n=(model.width-line_w)/(align=="left"?1:2)}r.drawImage(i,576-line_w,0,line_w,line_h,n,0,line_w,line_h)}else{if(align!="left"){n=(model.width-line_w)/(align=="right"?1:2)}r.drawImage(i,0,192-line_h,line_w,line_h,n,0,line_w,line_h)}}r.fillStyle="#000000";for(o in vline){p=vline[o];t=line_convert[p.style];r.fillRect(p.x,0,t.w,q.height);if(t.d){r.fillRect(p.x+t.w+1,0,t.w,q.height)}}s.clearRect(0,0,i.width,i.height)}$("#preview-paper").append(q);no_rotate_part[current_canvas_line]=0;current_canvas_line=current_canvas_line+1;line_x=0;line_w=0;line_h=0}function drawHLine(){var i,n,o,l,p,k,m;if(line_w>0){hline=[];drawFeed(0)}else{o=$("#preview-text").get(0);if(o.getContext){l=o.getContext("2d");l.fillStyle="#000000";for(p=0;p<hline.length;p++){k=hline[p];m=line_convert[k.style];l.fillRect(k.x1,0,k.x2-k.x1,m.w);if(m.d){l.fillRect(k.x1,m.w+1,k.x2-k.x1,m.w)}line_h=Math.max(line_h,m.d?m.w*2+1:m.w)}i=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:line_h}).get(0);if(i.getContext){n=i.getContext("2d");n.drawImage(o,0,0,model.width,line_h,0,0,model.width,line_h);n.fillStyle="#000000";for(p in vline){k=vline[p];m=line_convert[k.style];n.fillRect(k.x,0,m.w,i.height);if(m.d){n.fillRect(k.x+m.w+1,0,m.w,i.height)}}l.clearRect(0,0,o.width,o.height)}}$("#preview-paper").append(i);no_rotate_part[current_canvas_line]=0;current_canvas_line=current_canvas_line+1;hline=[];line_x=0;line_w=0;line_h=0}}function drawIcon(n,m){var r,p,l=0,q,i,o;if(hline.length>0){drawHLine()}r=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:48}).get(0);if(r.getContext){p=r.getContext("2d");p.fillStyle="#000000";for(q in vline){i=vline[q];o=line_convert[i.style];p.fillRect(i.x,0,o.w,r.height);if(o.d){p.fillRect(i.x+o.w+1,0,o.w,r.height)}}if(rotate){p.translate(model.width,48);p.rotate(Math.PI)}if(align!="left"){l=(model.width-40)/(align=="right"?1:2)}p.shadowBlur=4;p.shadowColor="#000000";p.drawImage(n,l+4,8);p.shadowBlur=1;p.font="12px sans-serif";p.textBaseline="middle";if(align=="right"){p.textAlign="right";p.fillText(m,l-4,24)}else{p.textAlign="left";p.fillText(m,l+44,24)}p.shadowBlur=0;p.setTransform(1,0,0,1,0,0)}$("#preview-paper").append(r);no_rotate_part[current_canvas_line]=0;current_canvas_line=current_canvas_line+1;line_x=0;line_w=0;line_h=0}function drawFixedIcon(j,i){var h,g;if(hline.length>0){drawHLine()}h=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:48}).get(0);if(h.getContext){g=h.getContext("2d");g.shadowBlur=4;g.shadowColor="#000000";g.drawImage(j,4,8);g.shadowBlur=1;g.font="12px sans-serif";g.textBaseline="middle";g.textAlign="left";g.fillText(i,44,24);g.shadowBlur=0}$("#preview-paper").append(h);no_rotate_part[current_canvas_line]=1;current_canvas_line=current_canvas_line+1}function drawImage(z,y,v,E,h,u){var B,C,i,F,w,l=0,x,A,D;if(hline.length>0){drawHLine()}if(u){F=model.width;w=z.height*F/z.width|0}else{F=Math.min(z.width,model.width);w=z.height}B=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:w}).get(0);if(B.getContext){C=B.getContext("2d");if(align!="left"&&model.width>F){l=(model.width-F)/(align=="right"?1:2)}if(u){C.drawImage(z,l,0,F,w)}else{C.drawImage(z,0,0,F,w,l,0,F,w)}i=C.getImageData(l,0,F,w);if(v=="gray16"){toGrayImage(i,E)}else{toMonoImage(i,h,E,color_convert[y])}C.putImageData(i,l,0);for(x in vline){A=vline[x];D=line_convert[A.style];C.fillRect(A.x,0,D.w,B.height);if(D.d){C.fillRect(A.x+D.w+1,0,D.w,B.height)}}}$("#preview-paper").append(B);no_rotate_part[current_canvas_line]=0;current_canvas_line=current_canvas_line+1;line_x=0;line_w=0;line_h=0}function drawPageText(k){var j,m,l,n,i;if(hline.length>0){drawHLine()}j=$("#preview-area").get(0);if(j.getContext){m=j.getContext("2d");m.textAlign="left";m.textBaseline="alphabetic"}str=k.match(/[\ud800-\udbff][\udc00-\udfff]|[\u304B\u304D\u304F\u3051\u3053\u30AB\u30AD\u30AF\u30B1\u30B3\u30BB\u30C4\u30C8\u31F7]\u309A|[\u00E6\u0254\u028C\u0259\u025A]\u0300|[\u0254\u028C\u0259\u025A]\u0301|\u02E9\u02E5|\u02E5\u02E9|[^\ud800-\udfff]/g)||[];for(n=0;n<str.length;n++){l=str[n];switch(l){case"\t":if(page_x==(page_dir.w?area_w:area_h)){drawPageFeed(page_linespc)}i=font_a*4;page_x=Math.floor(page_x/i)*i+i;if(page_x>(page_dir.w?area_w:area_h)){drawPageFeed(page_linespc)}break;case"\n":drawPageFeed(page_linespc);break;case"\r":break;default:drawPageChar(m,l);break}}}function drawPageChar(n,l){var j,k,h,m;n.font="24px "+font;if(n.measureText(l).width<18){m=model.ank[text_f];if(m==0){m=font_a}else{font_a=m}h=m/2}else{m=model.kanji[text_f];if(m==0){m=font_k}else{font_k=m}h=m}n.font=(m-2)+"px "+font;if(page_x+h*text_w>(page_dir.w?area_w:area_h)){drawPageFeed(page_linespc)}j=page_x/text_w;k=page_y/text_h;n.fillStyle=text_c;n.strokeStyle=text_c;n.shadowColor=text_c;if(page_dir.w){n.setTransform(text_w,0,0,text_h,0,0);n.translate(page_dir.x*area_w/text_w,page_dir.y*area_h/text_h);n.rotate(page_dir.r)}else{n.setTransform(text_h,0,0,text_w,0,0);n.translate(page_dir.x*area_w/text_h,page_dir.y*area_h/text_w);n.rotate(page_dir.r)}if(text_r){n.fillRect(j,k,h,-m);c="#f0f0f0";n.fillStyle=c;n.strokeStyle=c;n.shadowColor=c}if(h==m&&text_l=="en"){n.strokeRect(j+2,k-2,h-4,4-m)}else{n.shadowBlur=text_s?2:0;n.fillText(l,j,k-4);if(text_e){n.fillText(l,j+1,k-4)}n.shadowBlur=0}if(text_u){n.fillRect(j,k-1,h,1)}n.setTransform(1,0,0,1,0,0);page_x+=h*text_w;area_valid=true}function drawPageFeed(b){page_x=0;page_y+=b}function drawPageIcon(l,k,j){var i,h;i=$("#preview-area").get(0);if(i.getContext){h=i.getContext("2d");h.translate(page_dir.x*area_w,page_dir.y*area_h);h.rotate(page_dir.r);h.shadowBlur=4;h.shadowColor="#000000";h.drawImage(l,page_x+4,page_y+(j?8:-39));h.shadowBlur=1;h.font="12px sans-serif";h.textBaseline="middle";h.textAlign="left";h.fillText(k,page_x+44,page_y+(j?24:-23));h.shadowBlur=0;h.setTransform(1,0,0,1,0,0)}page_x+=48;area_valid=true}function drawPageImage(z,y,w,h,s,v){var A,B,u,q,t,r,x;A=$("#epos-image").get(0);if(v){r=page_dir.w?area_w:area_h;x=z.height*r/z.width|0}else{r=Math.min(z.width,page_dir.w?area_w:area_h);x=z.height}A.width=r;A.height=x;if(w!="gray16"){u=$("#preview-area").get(0);if(A.getContext&&u.getContext){B=A.getContext("2d");q=u.getContext("2d");B.clearRect(0,0,r,x);if(v){B.drawImage(z,0,0,r,x)}else{B.drawImage(z,0,0,r,x,0,0,r,x)}t=B.getImageData(0,0,r,x);toMonoImage(t,s,h,color_convert[y]);B.putImageData(t,0,0);q.translate(page_dir.x*area_w,page_dir.y*area_h);q.rotate(page_dir.r);q.drawImage(A,page_x,page_y-x+1);q.setTransform(1,0,0,1,0,0)}area_valid=true}}function drawPageLine(p,l,k,n,m){var j,o;j=$("#preview-area").get(0);if(j.getContext){o=j.getContext("2d");o.translate(page_dir.x*area_w,page_dir.y*area_h);o.rotate(page_dir.r);o.fillStyle="#000000";if(l==n){o.fillRect(p,l,k-p,m.w);if(m.d){o.fillRect(p,l+m.w+1,k-p,m.w)}}else{if(p==k){o.fillRect(p,l,m.w,n-l);if(m.d){o.fillRect(p+m.w+1,l,m.w,n-l)}}}o.setTransform(1,0,0,1,0,0)}area_valid=true}function drawPageRect(p,l,k,n,m){var j,o;j=$("#preview-area").get(0);if(j.getContext){o=j.getContext("2d");o.translate(page_dir.x*area_w,page_dir.y*area_h);o.rotate(page_dir.r);o.fillStyle="#000000";o.fillRect(p,l,k-p,m.w);o.fillRect(p,l,m.w,n-l);o.fillRect(k,n,p-k,-m.w);o.fillRect(k,n,-m.w,l-n);if(m.d){d=m.w+1;o.fillRect(p+d,l+d,k-p-d-d,m.w);o.fillRect(p+d,l+d,m.w,n-l-d-d);o.fillRect(k-d,n-d,p-k+d+d,-m.w);o.fillRect(k-d,n-d,-m.w,l-n+d+d)}o.setTransform(1,0,0,1,0,0)}area_valid=true}function moveAreaToPage(){var g=$("#preview-area").get(0),i=$("#preview-page").get(0),j,h;if(area_valid){if(g.getContext&&i.getContext){j=g.getContext("2d");h=i.getContext("2d");h.drawImage(g,0,0,area_w,area_h,area_x,area_y,area_w,area_h);j.clearRect(0,0,g.width,g.height)}page_h=Math.max(page_h,area_y+area_h)}}function drawPage(){var r,s,h,q,l,o,p,t,i;l=Math.min(page_h,model.page.max_h);if(l==0){l=model.page.ini_h}r=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:l}).get(0);h=$("#preview-page").get(0);if(r.getContext&&h.getContext){s=r.getContext("2d");q=h.getContext("2d");s.drawImage(h,0,0,model.width,l,0,0,model.width,l);q.clearRect(0,0,h.width,h.height)}$("#preview-paper").append(r);no_rotate_part[current_canvas_line]=0;current_canvas_line=current_canvas_line+1}function RotatePage(i){if(hline.length>0){drawHLine()}$("#preview-rotate").width(model.width);var j=0,l=0;var n=$("#preview-rotate").clone().removeAttr("id").attr({width:model.width,height:model.height}).get(0);var h=n.getContext("2d");h.translate(n.width,n.height);h.rotate(Math.PI);var e=$("#preview-rotate").clone().removeAttr("id").attr({width:model.width,height:model.height}).get(0);var m=e.getContext("2d");var g=0;var k=0;$("#preview-paper canvas").each(function(){if(g>=i&&no_rotate_part[g]==0){var q=$(this).get(0),o;o=q.getContext("2d");h.drawImage(q,0,j);j=j+q.height;$(this).remove()}if(g>=i&&no_rotate_part[g]==1){var p=Math.min(j,model.page.max_h);if(p>0){m.drawImage(n,0,n.height-p,model.width,p,0,k,model.width,p);k=k+p}var q=$(this).get(0),o;o=q.getContext("2d");m.drawImage(q,0,k);k=k+q.height;h.clearRect(0,0,n.width,n.height);j=0;$(this).remove()}g=g+1});if(j>0){var f=Math.min(j,model.page.max_h);m.drawImage(n,0,n.height-f,model.width,f,0,k,model.width,f);k=k+f;h.clearRect(0,0,n.width,n.height)}if(k>0){var f=Math.min(k,model.page.max_h);var b=$("#preview-line").clone().removeAttr("id").attr({width:model.width,height:f}).get(0);var a=b.getContext("2d");a.drawImage(e,0,0,model.width,f,0,0,model.width,f);$("#preview-paper").append(b);current_canvas_line=i+1;no_rotate_part=[];m.clearRect(0,0,e.width,e.height)}$("#preview-rotate").height(0)}function toMonoImage(x,i,p,f){var U=String.fromCharCode,b=[[2,130,34,162,10,138,42,170],[194,66,226,98,202,74,234,106],[50,178,18,146,58,186,26,154],[242,114,210,82,250,122,218,90],[14,142,46,174,6,134,38,166],[206,78,238,110,198,70,230,102],[62,190,30,158,54,182,22,150],[254,126,222,94,246,118,214,86]],g=x.data,T=x.width,q=x.height,X=parseInt(f.slice(1,3),16),v=parseInt(f.slice(3,5),16),R=parseInt(f.slice(5,7),16),w=0,Q=0,S=0,n=128,h=new Array(),V,W,e,P,j,s,t;if(i==1){s=T;while(s--){h.push(0)}}for(t=0;t<q;t++){V=0;W=0;s=0;while(s<T){e=s&7;if(i==0){n=b[t&7][e]}P=Math.pow(((g[Q++]*0.29891+g[Q++]*0.58661+g[Q++]*0.11448)*g[Q]/255+255-g[Q++])/255,1/p)*255|0;if(i==1){P+=h[s]+V>>4;j=P-(P<n?0:255);if(s>0){h[s-1]+=j}h[s]=j*7+W;V=j*5;W=j*3}w=P<n?0:255;g[S++]=Math.max(w,X);g[S++]=Math.max(w,v);g[S++]=Math.max(w,R);g[S++]=255-w;s++}}}function toGrayImage(E,h){var D=String.fromCharCode,i=[[0,9,2,11],[13,4,15,6],[3,12,1,10],[16,7,14,5]],b=E.data,w=E.width,j=E.height,q=0,v=0,C=0,F,g,x,n,p;for(p=0;p<j;p++){n=0;while(n<w){F=n&1;g=Math.pow(((b[v++]*0.29891+b[v++]*0.58661+b[v++]*0.11448)*b[v]/255+255-b[v++])/255,1/h)*255|0;x=g/17|0;if(i[p&3][n&3]<g%17){x++}q=x<<4;b[C++]=q;b[C++]=q;b[C++]=q;b[C++]=255;n++}}}var epos=new epson.ePOSPrint();epos.onreceive=function(b){if(b.printjobid.length>0){addPrintInfo((b.success?message.success+" (":message.failure+" ("+message.epos_code+": "+b.code+", ")+message.epos_jobid+": "+b.printjobid+")")}else{addPrintInfo(b.success?message.success:message.failure+" ("+message.epos_code+": "+b.code+")")}};epos.onerror=function(b){addPrintInfo(message.epos_error+" ("+message.epos_status+": "+b.status+")")};epos.ononline=function(){addPrintInfo(message.epos_online)};epos.onoffline=function(){addPrintInfo(message.epos_offline)};epos.onpoweroff=function(){addPrintInfo(message.epos_poweroff)};epos.oncoverok=function(){addPrintInfo(message.epos_coverok)};epos.oncoveropen=function(){addPrintInfo(message.epos_coveropen)};epos.onpaperok=function(){addPrintInfo(message.epos_paperok)};epos.onpapernearend=function(){addPrintInfo(message.epos_papernearend)};epos.onpaperend=function(){addPrintInfo(message.epos_paperend)};epos.ondrawerclosed=function(){addPrintInfo(message.epos_drawerclosed)};epos.ondraweropen=function(){addPrintInfo(message.epos_draweropen)};epos.onbatterylow=function(){addPrintInfo(message.epos_batterylow)};epos.onbatteryok=function(){addPrintInfo(message.epos_batteryok)};epos.onbatterystatuschange=function(b){if(b>0){addPrintInfo(message.epos_batterystatus+": 0x"+("000"+b.toString(16)).slice(-4))}};function setPrintDoc(){$("#print-doc").val(xml)}function sendPrintDoc(){var f,e;if($("#setting-jobid").is(":checked")){f=new Date();e="E"+f.getHours()+("0"+f.getMinutes()).slice(-2)+("0"+f.getSeconds()).slice(-2)+("00"+f.getMilliseconds()).slice(-3);epos.send($("#print-doc").val(),e);addPrintInfo(message.epos_send+" ("+message.epos_jobid+": "+e+")")}else{epos.send($("#print-doc").val());addPrintInfo(message.epos_send)}}function setStatusMonitor(){epos.address=($("#setting-https").is(":checked")?"https":"http")+"://"+$("#setting-ipaddr").val()+"/cgi-bin/epos/service.cgi?devid="+$("#setting-devid").val()+"&timeout="+$("#setting-timeout").val();if($("#setting-status").is(":checked")){if(!epos.enabled){epos.open();addPrintInfo(message.epos_open)}}else{if(epos.enabled){epos.close();addPrintInfo(message.epos_close)}}if($("#setting-drawer").val()=="high"){epos.drawerOpenLevel=epos.DRAWER_OPEN_LEVEL_HIGH}else{epos.drawerOpenLevel=epos.DRAWER_OPEN_LEVEL_LOW}}function addPrintInfo(i){var g=new Date(),h=[g.getFullYear(),("0"+(g.getMonth()+1)).slice(-2),("0"+g.getDate()).slice(-2)].join("-"),j=[g.getHours(),("0"+g.getMinutes()).slice(-2),("0"+g.getSeconds()).slice(-2)].join(":");$("#print-info").val($("#print-info").val()+h+" "+j+" "+i+"\n").change()};